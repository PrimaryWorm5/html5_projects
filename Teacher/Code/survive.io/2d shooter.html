<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<canvas id="canvas"></canvas>
<script type="text/javascript">
document.addEventListener('keydown', keyDown, false);
document.addEventListener('keyup', keyUp, false);
document.addEventListener('mousemove', mouse);
document.addEventListener('click', shot);
var canvas = document.getElementById('canvas')
var ctx = canvas.getContext("2d")
canvas.width = window.innerWidth-20
canvas.height = window.innerHeight-30
var x = 100,
y = 100,
hero_rotate = 0,
mx = 0,
my = 0,
dx = 0,
dy = 0,
r = 0,
hv=3,
sprint=100;
var rightPressed = false;
var leftPressed = false;
var upPressed = false;
var downPressed = false;
var tree = new Image();
    tree.src = "tree.png"
var box = new Image();
    box.src = "box.png"



function draw(){
	// ctx.clearRect(0,0,innerWidth,innerHeight)
	ctx.beginPath()
	ctx.arc(x,y,30,hero_rotate,hero_rotate+6.2)
	ctx.fillStyle = "green"
	ctx.fill()
	ctx.lineWidth = 5
	// ctx.lineTo(mx,my)
	ctx.stroke()
	for(var i=0;i<countshots;i++){
		var s = shots[i];
		var b = boxes[i];
		ctx.beginPath()
		ctx.arc(s.x,s.y,5,0,7)
		ctx.fill()
		s.x+=s.vx;
		s.y+=s.vy;
	}
	// if(x>innerWidth/2-100&&x<innerWidth/2+100){hv=1.7}else{hv=3}
	if (rightPressed){
		x+=hv
	}
	if (leftPressed){
		x-=hv
	}
	if (upPressed) {
		y-=hv
	}
	if (downPressed){
		y+=hv
	}
	dx=x-mx
	dy=y-my
	var tan =dy/dx
	var atan = Math.atan(tan)*180/Math.PI;
	if(dx>=0 && dy>=0){atan+=180;}
	else if(dx>=0 && dy<=0){atan-=180}
		hero_rotate=atan/60
	if(sprint<0){hv=3;}
	if(hv==3){sprint+=0.4}else{sprint--}
	if(sprint>=100){sprint=100}
}
var counttrees = 10;
var countboxes = 5;
var countshots = 0;
var trees = []
var boxes = []
var shots = []
for(var i=0;i<counttrees;i++){
	trees.push({x:Math.random()*innerWidth-200,y:Math.random()*innerHeight-200,})}
for(var i=0;i<countboxes;i++){
	boxes.push({x:Math.random()*innerWidth-200,y:Math.random()*innerHeight-200,})}
for(var i=0;i<countshots;i++){
	shots.push({x:x,y:y,vx:0,vy:0})}
function bg(){
ctx.clearRect(0,0,innerWidth,innerHeight)
ctx.fillStyle="#faf3dd"
ctx.fillRect(0,0,innerWidth,innerHeight)
ctx.beginPath()
ctx.moveTo(innerWidth/2-100,0)
ctx.lineTo(innerWidth/2-50,innerHeight)
ctx.lineTo(innerWidth/2+100,innerHeight)
ctx.lineTo(innerWidth/2+150,0)
ctx.fillStyle = '#64958f'
ctx.fill()
ctx.beginPath()
ctx.rect(55,55,sprint*5,20);
ctx.fillStyle="#407088"
ctx.fill()
ctx.beginPath()
ctx.rect(50,50,sprint*5,20);
ctx.fillStyle="#70adb5"
ctx.fill()
for(var i =0;i<counttrees;i++){
	var t = trees[i];
ctx.drawImage(tree, t.x,t.y,200,200);}
for(var i =0;i<countboxes;i++){
	var b = boxes[i];
ctx.drawImage(box, b.x,b.y,100,100);}
draw()
}
function mouse(){
mx = event.x;
my = event.y;
}
function keyDown() {
    if(event.keyCode == 68) {
        rightPressed = true;
    }
    else if(event.keyCode == 65) {
        leftPressed = true;
    }
    if(event.keyCode == 83) {
    	downPressed = true;
    }
    else if(event.keyCode == 87) {
    	upPressed = true;
    }
    if(sprint>0){
    if(event.keyCode==16){hv=6}}else{hv=3}
}
function keyUp(){
	if(event.keyCode == 68) {
        rightPressed = false;
    }
    else if(event.keyCode == 65) {
        leftPressed = false;
    }
    if(event.keyCode == 83) {
    	downPressed = false;
    }
    else if(event.keyCode == 87) {
    	upPressed = false;
    	}
    if(event.keyCode==16){hv=3}
}
function shot(){
	countshots++
	shots.push({x:x,y:y,vx:-dx/10,vy:-dy/10})
}
setInterval(bg,32)
</script>
</body>
</html>